external function LongInt POSNETHexToLong(string);external function val AbsoluteVal(val);	SetLangMode(LangUkrainian,"UKR",0);procedure ErrorMessage(integer stat, integer error,var boolean done)beginstring 50 Message;integer b1,b2,b3,b4,b5,b6,b7,b0,stat1;val del;  Message = "";    if (error!=0) then begin    done = false;    switch(error) begin    case 1:Message = Message & "ошибка принтера ";    case 2:Message = Message & "закончилась бумага ";    case 4:Message = Message & "сбой фискальной памяти ";    case 6:Message = Message & "снижения напряжения питания ";    case 8:Message = Message & "фискальная память переполнена ";    case 16:Message = Message & "команда запрещена в данном режиме ";    case 19:Message = Message & "ошибка программирования логотипа ";    case 20:Message = Message & "неправильная длина строки ";    case 21:Message = Message & "неправильный пароль ";    case 22:Message = Message & "Несуществующий номер (пароля, строки) ";    case 23:Message = Message & "налоговая группа не существует или не установлена, налоги не вводились ";    case 24:Message = Message & "тип оплат не существует ";    case 25:Message = Message & "недопустимые коды символов ";    case 26:Message = Message & "превышение количества налогов ";    case 27:Message = Message & "отрицательная продажа больше суммы предыдущих продаж чека ";    case 28:Message = Message & "ошибка в описании артикула ";    case 30:Message = Message & "ошибка формата даты/времени ";    case 31:Message = Message & "превышение регистраций в чеке ";    case 32:Message = Message & "превышение разрядности вычисленной стоимости ";    case 33:Message = Message & "переполнение регистра дневного оборота ";    case 34:Message = Message & "переполнение регистра оплат ";    case 35:Message = Message & "сума выдано больше, чем в денежном ящике ";    case 36:Message = Message & "дата до даты последнего z-отчета ";    case 37:Message = Message & "открыт чек выплат, продажи запрещены ";    case 38:Message = Message & "открыт чек продаж, выплаты запрещены ";    case 39:Message = Message & "команда запрещена, чек не открыт ";    case 41:Message = Message & "команда запрещена до Z-отчета ";    case 42:Message = Message & "команда запрещена, не было чеков ";    case 43:Message = Message & "сдача с  этой оплаты запрещена ";    case 44:Message = Message & "команда запрещена, чек открыт ";    case 45:Message = Message & "скидки\наценки запрещены, не было продаж ";    case 46:Message = Message & "команда запрещена после начала оплат ";    end;  end;    if(true) then begin    stat1 = stat;    b0 = 0;    b1 = 0;    b2 = 0;    b3 = 0;    b4 = 0;    b5 = 0;    b6 = 0;    b7 = 0;        if(stat>0)then begin      //done = false;    end;        if(stat1>=128) then begin      b7=1;      stat1 = stat1-128;      Message = Message & "функция не существует или запрещена в данном режиме; ";    end;        if(stat1>=64) then begin      b6=1;      stat1 = stat1-64;       Message = Message & "снижение рабочего напряжения питания; ";    end;        if(stat1>=32) then begin      b5=1;      stat1 = stat1-32;      Message = Message & "превышение продолжительности смены; ";    end;        if(stat1>=16) then begin      b4=1;      stat1 = stat1-16;      Message = Message & "ошибка индикатора; ";    end;        if(stat1>=8) then begin      b3=1;      stat1 = stat1-8;      Message = Message & "неправильная дата или ошибка часов; ";    end;        if(stat1>=4) then begin      b2=1;      stat1 = stat1-4;      Message = Message & "ошибка или переполнение фискальной памяти; ";    end;        if(stat1>=2) then begin      b1=1;      stat1 = stat1-2;      Message = Message & "нет бумаги; ";    end;        if(stat1>=1) then begin      b0=1;      Message = Message & "принтер не готов. ";    end;  end;      //messageBox(0,stat &"_"& b7 & b6 & b5 & b4 & b3 & b2 & b1 & b0);          if(nonblank(Message)) then begin    MessageBox(0,Message);end;return;end;procedure NumToHex(string instr,var string res)BEGIN  string 16 hexs;  LongInt l,i;  string 255 tstr;    res = "";  l = FirstInRange(instr,10);  hexs = "0123456789ABCDEF";  for (i=0;i<8;i=i+1) begin    tstr = tstr & Mid(hexs,BitAnd(l,15),1);    l = l/16;  end;  for (i=len(tstr);i>=0;i=i-1) begin    res = res & Mid(tstr,i,1);  end;    RETURN;END;procedure CalcStr (var string str,var integer sum)begin  string 25 stroka,newstroka;string 1 char;integer i,c;newstroka = "";  for (i=0;i<len(str);i=i+1) begin    c=0;    char = mid(str,i,1);        c = asc(char);   //StopAlert(c);    if (c>=1040 and c<1088) then begin//    if (c>158) then begin        /*switch(c) begin          case 1025: c = 240;          case 1105: c = 241;          case 1028: c = 242;          case 1108: c = 243;          case 1031: c = 244;          case 1111: c = 245;          case 1168: c = 246;          case 1169: c = 247;          case 8470: c = 252;//№          case 1110: c = 105;          case 1030: c = 73;        otherwise           if (c>912) then begin*/            c = c - 912;          //end;        end;                if (c>=1088 and c<=1103) then begin            c = c - 864;        end;                if(c>1025) begin          switch(c) begin          case 1025: c = 240;          case 1105: c = 241;          case 1028: c = 242;          case 1108: c = 243;                    case 1031: c = 244;          case 1111: c = 245;                    case 1168: c = 246;          case 1169: c = 247;          case 8470: c = 252;//№          case 1110: c = 105;          case 1030: c = 73;        end;                                if((c<32) or (c> 175 and c< 224) or (c> 252)) then begin          c = 32;        end;                        newstroka = newstroka & chr(c);    end else begin      if(c==16) then begin        newstroka = newstroka & chr(c);               end;      //if (c==32) then begin c=95; end;      newstroka = newstroka & chr(c);    end;        sum = sum + c;    //StopAlert(c);  end;   str = newstroka;return;end;procedure CalcInt (var string int,var integer sum)beginstring 5 resint;integer c1,c2,c3,c4;string 1 char1, char2, char3, char4;NumToHex(evaltoval(int),resint);c1 = POSNETHexToLong(mid(resint,0,1))*16+POSNETHexToLong(mid(resint,1,1));char1 = chr(c1);if(c1==16) then begin  char1 = char1 & chr(c1);end;c2 = POSNETHexToLong(mid(resint,2,1))*16+POSNETHexToLong(mid(resint,3,1));char2 = chr(c2);if(c2==16) then begin  char2 = char2 & chr(c2);end;c3 = POSNETHexToLong(mid(resint,4,1))*16+POSNETHexToLong(mid(resint,5,1));char3 = chr(c3);if(c3==16) then begin  char3 = char3 & chr(c3);end;c4 = POSNETHexToLong(mid(resint,6,1))*16+POSNETHexToLong(mid(resint,7,1));char4 = chr(c4);if(c4==16) then begin  char4 = char4 & chr(c4);end;int = "";int = char4 & char3 & char2 & char1;sum = sum+c1+c2+c3+c4;return;end;procedure CalcInt1 (var string int,var integer sum)beginstring 5 resint;integer c1,c2,c3,c4;string 1 char1, char2, char3, char4;NumToHex(evaltoval(int),resint);c1 = POSNETHexToLong(mid(resint,0,1))*16+POSNETHexToLong(mid(resint,1,1));c1=128+c1;char1 = chr(c1);if(c1==16) then begin  char1 = char1 & chr(c1);end;c2 = POSNETHexToLong(mid(resint,2,1))*16+POSNETHexToLong(mid(resint,3,1));char2 = chr(c2);if(c2==16) then begin  char2 = char2 & chr(c2);end;c3 = POSNETHexToLong(mid(resint,4,1))*16+POSNETHexToLong(mid(resint,5,1));char3 = chr(c3);if(c3==16) then begin  char3 = char3 & chr(c3);end;c4 = POSNETHexToLong(mid(resint,6,1))*16+POSNETHexToLong(mid(resint,7,1));char4 = chr(c4);if(c4==16) then begin  char4 = char4 & chr(c4);end;int = "";int = char4 & char3 & char2 & char1;sum = sum+c1+c2+c3+c4;return;end;procedure CommandString(string filename, integer i,integer code,string param,integer sum,var boolean done)begin  area ArComm;  area test;  string 100 command,command1,command2,command3,comsum,command4,inparam;  integer sum1;  string 5 hex;  string 5 sumstr;    string 1 char,char1;  integer int,ii,int1,stat,error,errflag,int2,int3,int4,int5;  boolean testf,testf1;    if(done) then begin    inparam = param;    SetAreaZeroSize(ArComm);    command = "";    command1 = "";    command2 = "";    command3 = "";        command1 = command1 & chr(16) & chr(2);    command2 = command2 & chr(i);    if (i==16) then begin      command2 = command2 & chr(i);    end;    command3 = command3 & chr(code);    if (code==16) then begin      command3 = command3 & chr(code);    end;        if (blank(param)) then begin      inparam = chr(0);    end;       command4 = command4 & inparam;        comsum = command2 & command3 & command4;    sum1 = i+code+sum;        while(sum1>256) begin    sum1 = sum1-256;    end;        sumstr = chr(256-sum1);    //Messagebox(0,256-sum1);    /*if(asc(sumstr) == 16) then begin      sumstr = sumstr & sumstr;      messagebox(0,1);    end;*/        if(256-sum1 == 16) then begin      sumstr = sumstr & sumstr;      //messagebox(0,1);    end;        command = command1 & comsum & sumstr & chr(16) & chr(3);        addtexttoarea(command,ArComm);    writeareatofile(ArComm,filename,0);    //writeareatofile(ArComm,filename,0);        //SetAreaZeroSize(test);        ii=0;    setareazerosize(test);    testf = true;    testf1=true;    millisleep(150);    /*if(currentuser=="SA")then begin			while(testf) begin				char = ReadChar(ii);				int = asc(char);				addtexttoarea(char,test);								if(int==6 and testf1) then begin					testf1 = false;				end;								if(int==21 and testf1) then begin					testf = false;				end;								if(int==22) then begin					millisleep(200);				end;								if(int==3 and int1==16 and int2!=16) then begin					testf = false;				end;								if(blank(char)) then begin					testf = false;				end;				ii=ii+1;								if((int5==16) and (int4==2)) then begin					if((int1!=0 and int1!=16) or int!=0) then begin						ErrorMessage(int1,int,done);					end;				end;				int5 = int4;				int4 = int3;				int3 = int2;				int2 = int1;				int1=int;								if(ii>40) then begin					testf=false;				end;			end;    end; 	*/        //addtexttoarea(666,test);    //writeareatofile(test,"999",1);    // writeareatofile(ArComm,"999",1);  end;          return;end;procedure advancepaper(string filename,integer i,var boolean done)begininteger k;  for(k=0;k<i;k=k+1)begin    CommandString(filename,k+2,14,"",0,done);  end;return;end;procedure CashIn(string filename,string cash,var boolean done)begininteger sum;string 20 CashStr;    CashStr = AbsoluteVal(evaltoval(cash));    CalcInt(CashStr,sum);    if (evaltoval(cash)>=0) then begin    CommandString(filename,2,16,CashStr,sum,done);  end else begin  CommandString(filename,2,24,CashStr,sum,done);  end;return;end;procedure periodreport(string filename,string param,var boolean done)begininteger sd,sm,sy,ed,em,ey,sum;string 20 prm;    sd = evaltoval(mid(param,0,2));  sm = evaltoval(mid(param,2,2));  sy = evaltoval(mid(param,4,2));    if(sd>29) then begin    sd = sd+6;   end;  if(sm>29) then begin    sm = sm+6;   end;  if(sy>29) then begin    sy = sy+6;   end;    if(sd>19) then begin    sd = sd+6;   end;  if(sm>19) then begin    sm = sm+6;   end;  if(sy>19) then begin    sy = sy+6;   end;    if(sd>9) then begin    sd = sd+6;   end;  if(sm>9) then begin    sm = sm+6;   end;  if(sy>9) then begin    sy = sy+6;   end;    ed = evaltoval(mid(param,7,2));  em = evaltoval(mid(param,9,2));  ey = evaltoval(mid(param,11,2));    if(ed>29) then begin    ed = ed+6;   end;  if(em>29) then begin    em = em+6;   end;  if(ey>29) then begin    ey = ey+6;   end;    if(ed>19) then begin    ed = ed+6;   end;  if(em>19) then begin    em = em+6;   end;  if(ey>19) then begin    ey = ey+6;   end;    if(ed>9) then begin    ed = ed+6;   end;  if(em>9) then begin    em = em+6;   end;  if(ey>9) then begin    ey = ey+6;   end;    prm = chr(0) & chr(0) & chr(sd) & chr(sm) & chr(sy) & chr(ed) & chr(em) & chr(ey);  CalcInt(prm,sum);  CommandString(filename,2,17,prm,sum,done);  return;end;procedure periodreportshort(string filename,string param,var boolean done)begindate MyDate;integer sd,sm,sy,ed,em,ey,sum;string 20 prm;    sd = evaltoval(mid(param,0,2));  sm = evaltoval(mid(param,2,2));  sy = evaltoval(mid(param,4,2));    if(sd>29) then begin    sd = sd+6;   end;  if(sm>29) then begin    sm = sm+6;   end;  if(sy>29) then begin    sy = sy+6;   end;    if(sd>19) then begin    sd = sd+6;   end;  if(sm>19) then begin    sm = sm+6;   end;  if(sy>19) then begin    sy = sy+6;   end;    if(sd>9) then begin    sd = sd+6;   end;  if(sm>9) then begin    sm = sm+6;   end;  if(sy>9) then begin    sy = sy+6;   end;    ed = evaltoval(mid(param,7,2));  em = evaltoval(mid(param,9,2));  ey = evaltoval(mid(param,11,2));    if(ed>29) then begin    ed = ed+6;   end;  if(em>29) then begin    em = em+6;   end;  if(ey>29) then begin    ey = ey+6;   end;    if(ed>19) then begin    ed = ed+6;   end;  if(em>19) then begin    em = em+6;   end;  if(ey>19) then begin    ey = ey+6;   end;    if(ed>9) then begin    ed = ed+6;   end;  if(em>9) then begin    em = em+6;   end;  if(ey>9) then begin    ey = ey+6;   end;    prm = chr(0) & chr(0) & chr(sd) & chr(sm) & chr(sy) & chr(ed) & chr(em) & chr(ey);  CalcStr(prm,sum);  CommandString(filename,2,26,prm,sum,done);return;end;procedure PrintReciept(string filename,string param,var boolean done)beginval cash,term,i,rebeat,ai,present,costval;longint quant,vat,lines,num,cost,lenth,cashint,termint,presentint,rebsum;integer sum,sum1;string 50 name,serial,comstr,comint,coststr,numstr,cashstr,termstr,lenstr,serialstr,text,presentstr,pdvstr,rebsumstr,webmoney;area AFile;string 1 c1,c2,c3,c4;  if fileexists(param) begin    ADDFILETOAREA(param,AFile,0);    cash = evaltoval(GetTabTextFromArea(0,0,AFile));    term = evaltoval(GetTabTextFromArea(0,1,AFile));    present = evaltoval(GetTabTextFromArea(0,2,AFile));    webmoney = GetTabTextFromArea(0,3,AFile);    lines = evaltoval(GetTabTextFromArea(0,4,AFile));    for(i=0;i<lines;i=i+1) begin            vat = evaltoval(GetTabTextFromArea(0,(7*i)+5,AFile));      name = GetTabTextFromArea(0,(7*i)+6,AFile);            num = evaltoval(GetTabTextFromArea(0,(7*i)+7,AFile));      quant = evaltoval(GetTabTextFromArea(0,(7*i)+8,AFile));      cost = evaltoval(GetTabTextFromArea(0,(7*i)+9,AFile))*100;      rebeat = evaltoval(GetTabTextFromArea(0,(7*i)+10,AFile));      serial = GetTabTextFromArea(0,(7*i)+11,AFile);            if((cash>0)or(term>0)or(present>0)) then begin        coststr = cost;        sum = 0;        CalcInt(coststr,sum);//----        numstr = num;        CalcInt(numstr,sum);//-----       	lenth = len(name); // Edit ************************** Tuesday, 27 April 2010 2:04:17 PM        CalcStr(name,sum);//-------        switch(vat) begin          case 0: vat = 133;          case 1: vat = 128;        end;                lenstr = chr(lenth);        if(lenth == 16) then begin          lenstr = lenstr & chr(lenth);        end;        comstr = chr(quant) & chr(0) & chr(0) & chr(0) & coststr & chr(vat) & lenstr & name & numstr;        CommandString(filename,2+i,18,comstr,sum+lenth+quant+vat,done);        sum = 0;                millisleep(150);        if(rebeat!=0)then begin                    sum = 0;          if(rebeat>0)then begin            rebsum = round((cost*quant-cost*quant/10000*rebeat),0);            rebsum = (cost*quant - rebsum)*100;            rebsumstr = rebsum;            CalcInt1(rebsumstr,sum);          end else begin            rebeat = -rebeat;            rebsum = round((cost*quant-cost*quant/10000*rebeat),0);            rebsum = (cost*quant - rebsum)*100;            rebsumstr = rebsum;            CalcInt(rebsumstr,sum);          end;          comstr = chr(1) & rebsumstr & chr(0);                    CommandString(filename,1,35,comstr,sum+1,done);          sum = 0;        end;          serial = chr(len(serial)) & serial;        CalcStr(serial,sum);        millisleep(150);        CommandString(filename,2,11,serial,sum,done);      end;      if((cash<0)or(term<0)or(present<0)) then begin        coststr = cost/quant;        sum = 0;        CalcInt(coststr,sum);//----        numstr = num;        CalcInt(numstr,sum);//-----        lenth = len(name);// Edit ************************** Tuesday, 27 April 2010 2:10:52 PM        CalcStr(name,sum);//-------        switch(vat) begin          case 0: vat = 133;          case 1: vat = 128;        end;        lenstr = chr(lenth);        if(lenth == 16) then begin          lenstr = lenstr & chr(lenth);        end;        comstr = chr(quant) & chr(0) & chr(0) & chr(0) & coststr & chr(vat) & lenstr & name & numstr;        CommandString(filename,2+i,8,comstr,sum+lenth+quant+vat,done);        sum = 0;	          serial = chr(len(serial)) & serial;        CalcStr(serial,sum);        millisleep(150);        CommandString(filename,1,11,serial,sum,done);      end;    end;    if((cash<0)or(term<0)or(present<0)) then begin   //*********RETURN CHECK      sum = 0;      Serial = " ";      serial = chr(len(serial)) & serial;      CalcStr(serial,sum);      millisleep(150);      CommandString(filename,3,11,serial,sum,done);      sum = 0;      serial = USetStr(13086);      serial = chr(len(serial)) & serial;      CalcStr(serial,sum);      millisleep(150);      CommandString(filename,2,11,serial,sum,done);    end;			sum = 0;      comstr = "";      if(AbsoluteVal(present)>0) then begin        presentint = AbsoluteVal(present*100);        presentstr = "";        presentstr = presentint;        CalcInt1(presentstr,sum);        Serial = USetStr(31031);				serial = chr(len(serial)) & serial;				CalcStr(serial,sum1);        comstr = chr(3) & presentstr & serial;        CommandString(filename,3+i,35,comstr,sum+3+sum1,done);      end;  		sum = 0;            comstr = "";      if(AbsoluteVal(evaltoval(webmoney))>0) then begin        sum = 0;				Serial = USetStr(31032) & " " & webmoney;				serial = chr(len(serial)) & serial;				CalcStr(serial,sum);				millisleep(150);				CommandString(filename,3,11,serial,sum,done);				      end;        millisleep(150);      sum = 0;      comstr = "";      if(AbsoluteVal(cash)>=0) then begin        cashint = AbsoluteVal(cash*100);        cashstr = "";        cashstr = cashint;        CalcInt(cashstr,sum);        comstr = chr(3) & cashstr & chr(0) & chr(0);        CommandString(filename,4+i,20,comstr,sum+3,done);      end;           sum = 0;      comstr = "";      if(AbsoluteVal(term)>0) then begin        termint = AbsoluteVal(term*100);        termstr = "";        termstr = termint;        CalcInt(termstr,sum);        comstr = chr(0) & termstr & chr(0) & chr(0);        CommandString(filename,2+i,20,comstr,sum,done);      end;  end;return;end;procedure SetTimeOnPrinter(string filename, var boolean done)begin  string 100 command;	integer h,m,s,sum;		h = GetHour(CurrentTime);	m = GetMinute(CurrentTime);	s = GetSecond(CurrentTime);		if (h>19) then begin h = h+6; end;	if (h>9) then begin h = h+6; end;			if (m>59) then begin m = m+6; end;	if (m>49) then begin m = m+6; end;	if (m>39) then begin m = m+6; end;	if (m>29) then begin m = m+6; end;	if (m>19) then begin m = m+6; end;	if (m>9) then begin m = m+6; end;		if (s>59) then begin s = s+6; end;	if (s>49) then begin s = s+6; end;	if (s>39) then begin s = s+6; end;	if (s>29) then begin s = s+6; end;	if (s>19) then begin s = s+6; end;	if (s>9) then begin s = s+6; end;			command = chr(h) & chr(m) & chr(s);	  CalcStr(command,sum);  CommandString(filename,2,4,command,sum,done);		return;end;global procedure prt(string comand1,string param1)begininteger wn,i,k,d;boolean filef,done;record INVc INr;record RcVc RepSpec;integer lenth,sum;string 255 newparam,SendStr;string 255 param, comand; //Temp String Paramstring 255 filename;record LocalMachineBlock LMb;area SendArea;integer vat,quant,cashint,cost,num;// Edit ************************** Thursday, 30 August 2012 14:50:14string 200 comstr,coststr,numstr,name,lenstr,cashstr;// Edit ************************** Thursday, 30 August 2012 14:50:27val cash;area acommand;integer wait;blockload(LMb);comand = comand1;param = param1;filef = false;filename = "";if(WindowsMode==0) then begin    if (fileexists("/dev/cu.usbserial")) then begin    filename = "/dev/cu.usbserial";  end;    if (fileexists("/dev/cu.usbserial-FTFPCZSQ")) then begin    filename = "/dev/cu.usbserial-FTFPCZSQ";  end;  if (fileexists("/dev/cu.PL2303-0000101D")) then begin    filename = "/dev/cu.PL2303-0000101D";  end;    if (fileexists("/dev/cu.usbserial-FTR43ORW")) then begin    filename = "/dev/cu.usbserial-FTR43ORW";  end;      if (fileexists("/dev/cu.PL2303-0000201D")) then begin    filename = "/dev/cu.PL2303-0000201D";  end;  if (fileexists("/dev/cu.PL2303-00001006")) then begin    filename = "/dev/cu.PL2303-00001006";  end;  if (fileexists("/dev/cu.PL2303-00001004")) then begin    filename = "/dev/cu.PL2303-00001004";  end;  if (fileexists("/dev/cu.PL2303-00002006")) then begin    filename = "/dev/cu.PL2303-00002006";  end;  if (fileexists("/dev/cu.PL2303-00002004")) then begin    filename = "/dev/cu.PL2303-00002004";  end;  if (fileexists("/dev/cu.PL2303-0000301D")) then begin    filename = "/dev/cu.PL2303-0000301D";  end;  if (fileexists("/dev/cu.PL2303-0000401D")) then begin    filename = "/dev/cu.PL2303-0000401D";  end;  if (fileexists("/dev/cu.PL2303-0000501D")) then begin    filename = "/dev/cu.PL2303-0000501D";  end;  if (fileexists("/dev/cu.PL2303-0000105D")) then begin    filename = "/dev/cu.PL2303-0000105D";  end;  if (fileexists("/dev/cu.PL2303-0000105D")) then begin    filename = "/dev/cu.PL2303-0000105D";  end;  if (fileexists("/dev/cu.PL2303-0000205D")) then begin    filename = "/dev/cu.PL2303-0000205D";  end;  if (fileexists("/dev/cu.PL2303-0000305D")) then begin    filename = "/dev/cu.PL2303-0000305D";  end;  if (fileexists("/dev/cu.PL2303-0000405D")) then begin    filename = "/dev/cu.PL2303-0000405D";  end;  if (fileexists("/dev/cu.PL2303-0000505D")) then begin    filename = "/dev/cu.PL2303-0000505D";  end;  if (fileexists("/dev/cu.PL2303-1B1")) then begin    filename = "/dev/cu.PL2303-1B1";  end;  if (fileexists("/dev/cu.PL2303-2B1")) then begin    filename = "/dev/cu.PL2303-2B1";  end;  if (fileexists("/dev/cu.PL2303-3B1")) then begin    filename = "/dev/cu.PL2303-3B1";  end;  if (fileexists("/dev/cu.PL2303-0B1")) then begin    filename = "/dev/cu.PL2303-0B1";  end;  if (fileexists("/dev/cu.PL2303-0B2")) then begin    filename = "/dev/cu.PL2303-0B2";  end;  if (fileexists("/dev/cu.PL2303-0B3")) then begin    filename = "/dev/cu.PL2303-0B3";  end;  if (fileexists("/dev/cu.SLAB_USBtoUART")) then begin    filename = "/dev/cu.SLAB_USBtoUART";  end;      if(nonblank(filename)) then begin    openfile(filename);        k=0;    lenth = len(param);        if(mid(param,0,2)==".\\" )then begin k=2; end;        for(i=k;i<lenth;i=i+1) begin      if (mid(param,i,1)=="\\") then begin        newparam = newparam & "/";      end else begin        newparam = newparam & mid(param,i,1);      end;    end;    filef = true;    millisleep(150);    if(filef) then begin                  done = true;      CommandString(filename,1,1,"",0,done);      switch(comand) begin        case "xreport":       CommandString(filename,2,9,chr(0) & chr(0),0,done);                case "zreport":       CommandString(filename,2,13,chr(0) & chr(0),0,done);                        case "advancepaper":  advancepaper(filename,evaltoval(param),done);                case "cashin":        CashIn(filename,param,done);                 case "UStroke":       param = chr(0) & chr(len(param)) & param;                              CalcStr(param,sum);                              CommandString(filename,2,27,param,sum,done);                case "DStroke":       param = chr(1) & chr(len(param)) & param;                              CalcStr(param,sum);                              CommandString(filename,2,27,param,sum,done);                case "CStroke":       CommandString(filename,2,27,chr(0) & chr(0) & chr(0),0,done);                              CommandString(filename,3,27,chr(1) & chr(0) & chr(0),1,done);                case "print":         param = chr(len(param)) & param;                              CalcStr(param,sum);                              CommandString(filename,2,40,param,sum,done);                              CommandString(filename,3,40,chr(255) & chr(0),255,done);                                      case "nullcheck":     sum = 0;                              param = chr(len(param)) & param;                              CalcStr(param,sum);                              CommandString(filename,2,11,param,sum,done);                              param = "0";                              sum = 0;                              CalcInt(param,sum);                              CommandString(filename,3,20,chr(0) & param & chr(0) & chr(0),sum,done);                                      case "errorfix":      if(currentuser=="C7" or currentuser=="SA")then begin                                cost = 16384;                                cash = 163.84;                                quant = 1;                                num = 999;                                coststr = cost/quant;                                sum = 0;                                CalcInt(coststr,sum);//----                                numstr = num;                                CalcInt(numstr,sum);//-----                                name = "";                                lenth = len(name);// Edit ************************** Tuesday, 27 April 2010 2:10:52 PM                                CalcStr(name,sum);//-------                                vat = 0;                                switch(vat) begin                                  case 0: vat = 133;                                  case 1: vat = 128;                                end;                                lenstr = chr(lenth);                                if(lenth == 16) then begin                                  lenstr = lenstr & chr(lenth);                                end;                                quant = 1;                                comstr = chr(quant) & chr(0) & chr(0) & chr(0) & coststr & chr(vat) & lenstr & name & numstr;                                CommandString(filename,2,8,comstr,sum+lenth+quant+vat,done);                                millisleep(150);                                sum = 0;                                cashint = AbsoluteVal(cash*100);                                cashstr = "";                                cashstr = cashint;                                CalcInt(cashstr,sum);                                comstr = chr(3) & cashstr & chr(0) & chr(0);                                CommandString(filename,43,20,comstr,sum+3,done);                                                              end;                case "printreciept":  PrintReciept(filename,newparam,done);                case "periodreport":  PeriodReport(filename,param,done);        case "periodreportshort": PeriodReportShort(filename,param,done);        case "cancel":        CommandString(filename,2,15,"",0,done);                case "bigreport":     param = chr(0) & chr(0);                              CommandString(filename,2,10,param,0,done);        case "settimeprinter":SetTimeOnPrinter(filename,done);                case "UPString":      param = chr(0) & chr(len(param)) & param;                              CalcStr(param,sum);                              CommandString(filename,2,23,param,sum,done);                case "DOWNString":    param = chr(1) & chr(len(param)) & param;                              CalcStr(param,sum);                              CommandString(filename,2,23,param,sum,done);      end;      closefile;    end;  end else begin    runprogram("Datecs/prt.exe",comand & " " & param);  end;  end else begin	setareazerosize(acommand);  createfile("Datecs/Command.pos");  closefile;	//addstringtoarea(comand1 & " " & param1,acommand);	addtexttoarea(comand1 & " " & param1,acommand);	Writeareatofile(acommand,"Datecs/Command.pos",0);    createfile("Datecs/Flag.pos");  closefile;      wait = 0;  while(fileexists("Datecs/Flag.pos") or wait<20)begin  	millisleep(100);  	wait = wait + 1;  end;  end;return;end;