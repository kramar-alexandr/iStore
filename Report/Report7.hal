external procedure ExtractObj(string,var Integer,var string); //Ocean Plaza priceglobal procedure LocManyStock2Rn(record RcVc RepSpec)///new procedurebeginrecord ItemStatusVc ISr;record INVc INr;string 50 location;integer i;boolean TrHs,testf,x;record PLVc PLr;record ITVc ITr;  startreportnoheaderjob("LocManyStock2Rn");  StartFormat(15)    OutString(0,0,"PartNo",false);    OutString(1,0,"Name",false);    OutString(2,0,"In Stock",false);    OutString(3,0,"Available",false);    OutString(4,0,"Stock",false);    if(CurrentCompany==2)then begin      if(nonblank(RepSpec.f3))then begin      OutString(4,0,"Price " & RepSpec.f3,false);      end else begin      OutString(4,0,"Price P1",false);      OutString(4,0,"Price RRP",false);      end;    end;    if(CurrentCompany==1)then begin      if(nonblank(RepSpec.f3))then begin      OutString(4,0,"Price " & RepSpec.f3,false);      end else begin      OutString(4,0,"Price RRP_U",false);      end;    end;    if(CurrentCompany==6)then begin      if(nonblank(RepSpec.f3))then begin      OutString(4,0,"Price " & RepSpec.f3,false);      end else begin      OutString(4,0,"Price P211",false);      end;    end;    OutString(5,0,"Group",false);  endformat;    i=0;  ExtractObj(RepSpec.f1,i,location);  while (nonblank(location)) begin    ISr.Location = location;    TrHs = true;    while(loopkey("Location",ISr,1,Trhs)) begin      testf = true;      if(ISr.Location!=location) then begin Trhs = false; testf = false; end;      if(ISr.Instock==0) then begin testf = false; end;            if(testf) then begin        StartFormat(15)          INr.Code = ISr.Code;          x = ReadFirstMain(INr,1,true);          if(INr.Group=="FOL" or INr.Group=="PROMS")then begin  // Edit ************************** Friday, 11 February 2011 13:47:45            OutString(0,0,ISr.Code,false);            OutString(1,0,INr.Name,false);            OutString(2,0,ISr.Instock,false);            OutString(3,0,ISr.Instock-ISr.RsrvQty-ISr.StockRsrvQty,false);            OutString(4,0,ISr.Location,false);            if(CurrentCompany==2)then begin              PLr.ArtCode = ISr.Code;              PLr.PLCode = "P1";              if(ReadFirstMain(PLr,2,true))then begin                OutString(4,0,PLr.ExVatPrice,false);              end else begin                OutString(4,0,0,false);              end;               PLr.ArtCode = ISr.Code;              PLr.PLCode = "RRP";              if(ReadFirstMain(PLr,2,true))then begin                OutString(4,0,PLr.ExVatPrice,false);              end else begin                OutString(4,0,0,false);              end;            end;            if(CurrentCompany==1)then begin              PLr.ArtCode = ISr.Code;              PLr.PLCode = "RRP_U";              if(ReadFirstMain(PLr,2,true))then begin                OutString(4,0,PLr.ExVatPrice,false);              end else begin                OutString(4,0,0,false);              end;            end;                        if(CurrentCompany==6)then begin              PLr.ArtCode = ISr.Code;              PLr.PLCode = "P211";              if(ReadFirstMain(PLr,2,true))then begin                OutString(4,0,PLr.ExVatPrice,false);              end else begin                OutString(4,0,0,false);              end;            end;            ITr.Code = INr.Group;						readfirstmain(ITr,1,true);						OutString(5,0,ITr.Comment,false);          end;// Edit ************************** Friday, 11 February 2011 13:47:50        endformat;      end;      end;    resetloop(ISr);  ExtractObj(RepSpec.f1,i,location);  end;    endjob;return;end;